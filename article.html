<!DOCTYPE html>
<html lang="en">
<head>
    <!--Primary Tags-->
    <title>Manuscript | Whallop & Co.</title>
    <meta name="title" content="Manuscript | Whallop & Co.">
    <meta name="description" content="Manuscript from the Whallop & Co. Archive">
    <link rel="icon" type="image/png" href="images/favicon.png">
    
    <!--Open Graph Tags-->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://whallopco.github.io/WhallopCo/article">
    <meta property="og:title" content="Manuscript | Whallop & Co.">
    <meta property="og:description" content="Manuscript from the Whallop & Co. Archive.">
    <meta property="og:image" content= "https://raw.githubusercontent.com/WhallopCo/WhallopCo/refs/heads/main/images/Media-Card-Midnight.png">

    <!-- X (Twitter) Tags-->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://whallopco.github.io/WhallopCo/article">
    <meta property="twitter:title" content="Manuscript | Whallop & Co.">
    <meta property="twitter:description" content="Manuscript from the Whallop & Co. Archive.">
    <meta property="twitter:image" content="https://raw.githubusercontent.com/WhallopCo/WhallopCo/refs/heads/main/images/Media-Card-Midnight.png">

    <!--Page specs-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lora:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="midnight-mode">

<nav>
  <a href="index.html" class="logo">WHALLOP & CO.</a>
  <div class="nav-links">
    <a href="index.html">Back to Archive</a>
    <button id="theme-toggle" onclick="toggleTheme()">Switch Mode</button>
  </div>
</nav>

<div class="feed" id="article-content" style="margin-top: 50px;">
  </div>

<footer>
  <div class="footer-left">© 2026 WHALLOP & CO.</div>
  <div class="footer-right">
    <a href="stocksummary.html">STOCK DRAFT</a>
    <a href="contact.html">CONTACT</a>
    <a href="transcribe.html">TOOL</a>
  </div>
</footer>

<script src="js/theme.js"></script>

<script>
async function loadSingleArticle() {
  const params = new URLSearchParams(window.location.search);
  const articleId = params.get('id');

  try {
    // 1. Fetch the Metadata (Title, Author, Date)
    const indexResponse = await fetch('data/content.json');
    const indexData = await indexResponse.json();
    const metadata = indexData.find(w => w.id === articleId);

    // 2. Fetch the Full Text Content
    const libResponse = await fetch('data/library.json');
    const libData = await libResponse.json();
    const fullTextEntry = libData.find(w => w.id === articleId);

    const container = document.getElementById('article-content');

    if (metadata && fullTextEntry) {
      document.title = `${metadata.title} | Whallop & Co.`;
      
      // Handle PDF logic (checks if the content string ends in .pdf)
      let displayContent = "";
      
      if (fullTextEntry.content.endsWith('.pdf')) {
          const pdfUrl = `${fullTextEntry.content}#view=FitH&toolbar=0&navpanes=0`;
          displayContent = `
            <div class="pdf-container">
              <iframe src="${pdfUrl}" type="application/pdf" width="100%" height="100%"></iframe>
              <div class="pdf-fallback-link">
                <a href="${fullTextEntry.content}" target="_blank" class="btn-read">Open PDF in New Tab</a>
              </div>
            </div>`;
      } else {
          // Process text: Convert \n to <br> for HTML rendering
          const rawContent = fullTextEntry.content;
          const formattedContent = rawContent.replace(/\\n/g, '<br>');

          displayContent = metadata.type === 'poem' 
            ? `<div class="poetry-block">${formattedContent}</div>`
            : `<div class="essay-body">${formattedContent}</div>`;
      }

      // Render the Page
      container.innerHTML = `
        <span class="metadata">${metadata.date} • ${metadata.category.toUpperCase()}</span>
        <h1>${metadata.title}</h1>
        <div class="byline">By ${metadata.author}</div>
        ${displayContent}
      `;
    } else {
      // Error State
      container.innerHTML = `
        <div style="text-align: center; margin-top: 100px;">
          <h2>Manuscript Not Found</h2>
          <p class="excerpt">We could not locate this document in the archive.</p>
          <a href="index.html" class="btn-read" style="margin-top: 20px;">Return to Archive</a>
        </div>`;
    }
  } catch (error) {
    console.error("Error loading manuscript:", error);
  }
}
loadSingleArticle();
</script>
</body>
</html>